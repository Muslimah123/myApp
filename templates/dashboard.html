<!--
	This file provide information that is diplayed on the dashboard after the customer/client logs in
-->
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible"
      content="IE=edge">
    <meta name="viewport"
      content="width=device-width,
          initial-scale=1.0">
    <title>KasaFinTech/dashboard</title>
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/KasaFinTech_logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>

  <body>

    <!-- for header part -->
    <header>

      <div class="logosec">
        <div class="logo"><p>Welcome, {{ username }}!</p>
        </div>
        <i class="fa fa-bars menuicn" id="menuicn"></i>
      </div>

      <!--This part is for the microphone recording-->
      <div>
        <span style="font-size: 33px; color: #003976;">
        <i class="fa fa-microphone"></i>
        </span>
        <span style="font-size: 28px; font-weight: bold; color: green;">
        <a href="{{ url_for('recordingpage') }}">Record your Transaction</a>
        </span>
      </div>
      
      <!--The dasbhoard navigation bar-->
      <div class="nav-bar">
        <div class="message">
          <div class="circle"></div>
          <i class="fa fa-envelope"></i>
        
          <div class="dp">
            
              <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210180014/profile-removebg-preview.png"
                  class="dpicn"
                  alt="dp">    
          </div>
    
          <button id="open-modal-btn">Edit profile</button>
        </div>
      </div>
      
      <!--For profile updated located in the nav-->
      <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <div class="modal-header" style ="background-color: #002f62;">
            <h2>Update Profile</h2>
          </div>
          <div class="modal-body">
            <form method="POST" action="{{ url_for('update_profile') }}">
              <label for="name">Username:</label>
              <input type="text" id="name" name="name" value="{{ user['username'] if user else '' }}"><br>
            
              <label for="email">Email:</label>
              <input type="email" id="email" name="email" value="{{ user['email'] if user else '' }}"><br>
            
              <label for="password">Current Password:</label>
              <input type="password" id="password" name="password"><br>
            
              <label for="new_password">New Password:</label>
              <input type="password" id="new_password" name="new_password"><br>
            
              <label for="confirm_password">Confirm Password:</label>
              <input type="password" id="confirm_password" name="confirm_password"><br>
            
              {% if msg %}
              <div>{{ msg }}</div>
              {% endif %}
            
              <button type="submit" name="update-profile-btn">Update Profile</button>
            </form>
          </div>
        </div>
      </div>


      <!-- JavaScript pop to update profile -->
      <script>
          // Get the modal element
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("open-modal-btn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on the button, open the modal
        btn.onclick = function() {
          modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
          modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        }

      </script>
    </header>

    <!--This responsible for the dashboard left side navigation content-->
    <div class="main-container">
      <div class="navcontainer">
        <nav class="nav">
          <div class="nav-upper-options">
            <div class="nav-option option1">
                <img src="{{ url_for('static', filename='images/KasaFinTech_logo.png') }}" alt="OurApp Logo" class="nav-img">
                <a href="{{ url_for('dashboard') }}"><h3 style = "color: white;">Dashboard</h3></a>
            </div>
        
            <div class="option2 nav-option">
              <i class="fa fa-dollar-sign nav-img"></i>
              <a href="{{ url_for('revenue_dashboard') }}"><h3> Revenue</h3></a>
            </div>

            <div class="nav-option option3">
              <i class="fa fa-money-bill nav-img"></i>
              <a href="{{ url_for('expenses_dashboard') }}"><h3> Expenses</h3></a>
            </div>

            <div class="nav-option option4">
              <i class="fa fa-chart-pie nav-img"></i>
              <a href="{{ url_for('profit_dashboard') }}"><h3> Profit</h3></a>
            </div>

            <div class="nav-option option5">
              <i class="fa fa-shopping-cart nav-img"></i>
              <a href=" {{url_for('sales_by_products')}}"><h3> Sales by <br> products </h3></a>
            </div>

            <div class="nav-option option6">
              <i class="fa fa-list-alt nav-img"></i>
              <a href=" {{url_for('expenses_by_category')}}"> <h3> Expenses by Product</h3></a>
            </div>

            <div class="nav-option option7">
              <i class="fas fa-file-alt  nav-img"></i>
              <a href="{{ url_for('income_statement') }}"><h3> Income Statement <br>  Report</h3></a>
            </div>

            <div class="nav-option logout">
              <i class="fa fa-power-off nav-img"></i>
              <a href="{{ url_for('logout') }}"><h3>Logout</h3></a>
            </div>
          </div>
        </nav>
      </div>
    

      <div class="main">
        <div class="searchbar2">
          <input type="text"
            name=""
            id=""
            placeholder="Search">
          <div class="searchbtn">
            <i class="fa fa-search srchicn"></i>
          </div>
        </div>
        
        <!--This is for the contains on the dashboard like the small containers that provide database summaries.-->
        <div class="box-container">
          <div class="box box1" onclick="goToPage('{{ url_for('revenue_dashboard') }}')">
            <div class="text">
              <i class="fas fa-dollar-sign icon"></i>
              <h2 class="topic-heading">Revenue</h2>
              <div class="summary-details-wrapper">
                <p class="summary">Total revenue: ₵{{ total_sales or 0 }}</p>
                <button class="details-btn">View details</button>
              </div>
            </div>
          </div>

        <div class="box box2" onclick="goToPage('{{ url_for('expenses_dashboard') }}')">
          <div class="text">
            <i class="fas fa-money-bill-alt icon"></i>
            <h2 class="topic-heading">Expenses</h2>
            <div class="summary-details-wrapper">
              <p class="summary">Total expenses: ₵{{ total_expenses or 0 }}</p>
              <button class="details-btn">View details</button>
            </div>
          </div>
        </div>

        <div class="box box3" onclick="goToPage('{{ url_for('profit_dashboard') }}')">
          <div class="text">
            <i class="fas fa-chart-line icon"></i>
            <h2 class="topic-heading">Profit</h2>
            <div class="summary-details-wrapper">
              <p class="summary">Total profit: ₵{{ total_profit or 0 }}</p>
              <button class="details-btn">View details</button>
            </div>
          </div>
        </div>

        <div class="box box4" onclick="goToPage('{{ url_for('sales_by_products') }}')">
          <div class="text">
            <i class="fas fa-shopping-cart icon"></i>
            <h2 class="topic-heading">Sales by Products</h2>
            <div class="summary-details-wrapper">
              <p class="summary">Top selling product: {{top_selling_product_name}}</p>
              <button class="details-btn">View details</button>
            </div>
          </div>
        </div>

        <div class="box box5" onclick="goToPage('expenses_by_category')">
          <div class="text">
            <i class="fas fa-list-alt icon"></i>
            <h2 class="topic-heading">Expense by Product</h2>
            <div class="summary-details-wrapper">
              <p class="summary">Top purchased product: {{ top_purchased_product_name}}</p>
              <button class="details-btn">View details</button>
            </div>
          </div>
        </div>

        <div class="box box6" onclick="goToPage('{{ url_for('income_statement') }}')">
          <div class="text">
            <i class="fas fa-file-alt icon"></i>
            <h2 class="topic-heading">Report</h2>
            <div class="summary-details-wrapper">
              <p class="summary">View income statement</p>
              <button class="details-btn">View details</button>
            </div>
          </div>
        </div>
      


        <script>
            function goToPage(page) {
          window.location.href = page;
        }
        </script>

        <!-- Add this to your body tag -->
        <canvas id="myChart" width="400" height="400"></canvas>
        <script>
          var data = JSON.parse('{{ data | tojson | safe }}');
          var labels = [];
          var values = [];
          for (var i = 0; i < data.length; i++) {
              labels.push(data[i].date);
              values.push(data[i].total_sales);
          }
          
          var ctx = document.getElementById('myChart');
          var myLineChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: 'Revenue',
                data: values,
                backgroundColor: 'rgba(0, 186, 186)',
                borderColor: 'rgba(0, 186, 186)',
                borderWidth: 1
              }]
            },
            options: 
            {
              responsive: false,
              title: 
              {
                display: true,
                text: 'Revenue by Day'
              }
            }
          });
        </script>


        <div>
          <canvas id="mychart" width="400" height="400"></canvas>
        </div>

        <script>
          // Get data from Flask variable
          var data = JSON.parse('{{ purchases_data | tojson | safe }}');

          // Get labels and values from data
          var labels = [];
          var values = [];
          for (var i = 0; i < data.length; i++) {
            labels.push(data[i].item_name);
            values.push(data[i].total_purchases);
          }

          // Create chart using Chart.js library
          var ctx = document.getElementById('mychart');
          var myPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: labels,
              datasets: [{
                data: values,
                backgroundColor: [
                  'rgb(0,121,161)',
                  'rgb(0,159,212)',
                  'rgba(0, 186, 186)',
                  'rgba(75, 192, 192, 0.8)',
                  'rgba(0, 156, 186)',
                  'rgba(255, 159, 64, 0.8)'
                ],
                borderColor: [
                  'rgb(0,121,161)',
                  'rgb(0,159,212)',
                  'rgba(0, 186, 186)',
                  'rgba(75, 192, 192, 0.8)',
                  'rgba(0, 156, 186)',
                  'rgba(255, 159, 64, 0.8)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: false,
              title: {
                display: true,
                text: 'Top Selling Products'
              }
            }
          });
        </script>
      </div>
    </div>

    <!--link to scripts-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  </body>
</html>